action,ms,bytes,lang,code,repeate,minver,comment
before,0,0,q,.servers.CONNECTIONS:`segmentedtickerplant`sort`gateway`rdb`hdbtailer_seg1`tr_seg1,1,,"Add tailer and tailreader connections
before,0,0,q,tr:.servers.gethandlebytype[`tr_seg1;`any],1,,"Connect to tailreader handle to give access the tailreader1 for testing tailer1"
before,0,0,q,tl:.servers.gethandlebytype[`tailer_seg1;`any],1,,"Connect to tailer1 handle,so tailer can be tested through tl handle"
run,0,0,q,(tr"count tables[]")=2,1,,"Check the number of tables in the tailreader is currently 2"
run,0,0,q,tl".ds.savealltablesoverperiod[]",1,,"Running savedown function sould save tables but, there should be no data to savedown so the table count should stay the same"
run,0,0,q,(tr"count tables[]")=2,1,,"Check the number of tables in the tailreader has remained the same indicating the savedown didn't add any tables as there was none to add"
run,0,0,q,.os.sleep 10,1,,"Wait 10 seconds to populate tables with rows of data for trade and quote"
run,0,0,q,tl".wdb.numrows:100",1,,"Set row count as the standard row count is 10000 would be to large for a test"
run,0,0,q,tl"![;();0b;`symbol$()]`trade",1,,"Clear trade table,this is to check tables under the max row count won't be saved"
run,0,0,q,tl"![;();0b;`symbol$()]`trade";tl".ds.savealltablesoverperiod[]",1,,"Running savedown function on tables,should save quote and clear quote after the saved down"
true,0,0,q,(tl"count quote")=0,1,,"Check quote table data is cleared therefore the savedown function worked correctly"
true,0,0,q,(tr"count tables[]")=4,1,,"Tables count starts at 2 and the savedown should add the access table and quote table making 4"
true,0,0,q,(tr"count quote")>100,1,,"Check quote is above 100,this is to check quote has been saved and reload to the tailreader successfully"
run,0,0,q,.os.sleep 20,1,,"Wait for 20 secs,this is to populate the trade and quote table again"
run,0,0,q,tl".ds.savealltablesoverperiod[]",1,,"Running savedown function on tables,should save quote and clear quote after the saved down"
true,0,0,q,(tl"count quote")=0,1,,"Check quote table data is cleared therefore the savedown function worked correctly"
true,0,0,q,(tl"count trade")=0,1,,"Check trade table data is cleared therefore the savedown function worked correctly"
true,0,0,q,(tr"count quote")>200,1,,"Check quote value is above 200 indicating it saved againafter the previous save down"
true,0,0,q,(tr"count trade")>100,1,,"Check trade is above 100,this is to check trade has been saved and reload to the tailreader successfully"
true,0,0,q,(tr"count tables[]")=5,1,,"As the trade table has saved down the number of tables should have increased from 4 to 5"
