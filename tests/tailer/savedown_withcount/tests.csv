action,ms,bytes,lang,code,repeate,minver,comment
before,0,0,q,tr:.servers.gethandlebytype[`tr_seg1;`any],1,,"Connect to tailreader handle to give access the tailreader1 for testing tailer1"
before,0,0,q,tl:.servers.gethandlebytype[`tailer_seg1;`any],1,,"Connect to tailer1 handle,so tailer can be tested through tl handle"
before,0,0,q,tl".wdb.numrows:100",1,,"Set row count as the standard row count is 10000 would be to large for a test"
run,0,0,q,tl".ds.savealltables[.ds.td]",1,,"Running savedown function sould save tables but, there should be no data to savedown so the table count should stay the same"
run,0,0,q,.os.sleep 10,1,,"Wait 10 seconds to populate tables with rows of data for trade and quote"
run,0,0,q,tl"delete from `trade";tl".ds.savealltablesoverperiod[.ds.td]",1,,"We delete from trade to ensure that only quote is above the threshold as we want to test filtration"
true,0,0,q,(tr"count quote")>100,1,,"Check quote is above 100,this is to check quote has been saved and reload to the tailreader successfully"
run,0,0,q,.os.sleep 20,1,,"Wait for 20 secs,this is to populate the trade and quote table again"
run,0,0,q,tl".ds.savealltables[.ds.td]",1,,"Running savedown function on tables,should save quote"
true,0,0,q,(tr"count quote")>200,1,,"Check quote value is above 200 indicating it saved againafter the previous save down"
true,0,0,q,(tr"count trade")>100,1,,"Check trade is above 100,this is to check trade has been saved and reload to the tailreader successfully"
