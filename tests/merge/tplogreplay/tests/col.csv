action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.servers.startup[],1,,"Start TorQ connection management"
before,0,0,q,.proc.sys "sleep 3",1,,"Wait for proc to start"
before,0,0,q,h:gethandle[`hdb1],1,,"Open hdb handle"
before,0,0,q,.replay.mergemethod:`col,1,,"Set the merge method"
run,0,0,q,colreplay[],1,,"system call to replay log files"
run,0,0,q,.proc.sys "sleep 5",1,,"sleep wait for log files to replay"
run,0,0,q,-11!' logstoreplay:.replay.getstplogs[`$tplogdir],1,,"replay logs to memory"
run,0,0,q,h(`reload;`),1,,"call hdb to reload"
true,0,0,q,`p~(h"meta select from quote")[`sym]`a,1,,"Check p attribute is on sym column of xdaily in hdb"
true,0,0,q,(count quote) ~ count h"select from quote",1,,"Check all rows of data have been merged to hdb"
true,0,0,q,(cols quote) ~ h"1_ cols quote",1,,"Check all rows of data have been merged to hdb"
true,0,0,q,`p~(h"meta select from trade")[`sym]`a,1,,"Check p attribute is on sym column of xdaily in hdb"
true,0,0,q,(count trade) ~ count h"select from trade",1,,"Check all rows of data have been merged to hdb"
true,0,0,q,(cols trade) ~ h"1_ cols trade",1,,"Check all rows of data have been merged to hdb"
true,0,0,q,`p~(h"meta select from trade")[`sym]`a,1,,"Check p attribute is on sym column of xdaily in hdb"
true,0,0,q,(count packets) ~ count h"select from packets",1,,"packets is an empty log file so check merge process can handle empty table"
true,0,0,q,(cols packets) ~ h"1_ cols packets",1,,"check correct cols merged"#
true,0,0,q,(`symbol$())~key .replay.tempdir,1,,"check temporary storage has been removed"
after,0,0,q,.os.deldir string .Q.dd[.replay.hdbdir;`2022.06.16],1,,"remove hdb storage for log date"
