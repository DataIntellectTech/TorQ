action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.stplg.multilog:`tabperiod,1,,"Set default logging mode"
before,0,0,q,.stplg.init[],1,,"Initialise stp script"
before,0,0,q,trademeta:last select from .stpm.metatable where `trade in/: tbls,1,,"Save trade table meta"
before,0,0,q,quotemeta:last select from .stpm.metatable where `quote in/: tbls,1,,"Save quote table meta"
before,0,0,q,testtrade:(10?`4;10?100.0;10?100i;10#0b;10?.Q.A;10?.Q.A;10#`buy),1,,"Create test trade update"
before,0,0,q,testquote:(10?`4;10?100.0;10?100.0;10?100i;10?100i;10?.Q.A;10?.Q.A;10#`3),1,,"Create
test quote update"
true,0,0,q,.stplg.currlog[`trade;`logname]~trademeta[`logname],1,,"Check logname saved to meta table"
true,0,0,q,.stplg.currlog[`quote;`logname]~quotemeta[`logname],1,,"Check logname saved to meta table"
true,0,0,q,(0#trade)~trademeta[`schema][`trade],1,,"Check schema saved to meta table"
true,0,0,q,(0#quote)~quotemeta[`schema][`quote],1,,"Check schema saved to meta table"
true,0,0,q,0=trademeta[`msgcount],1,,"Check no records listed in log"
true,0,0,q,0=quotemeta[`msgcount],1,,"Check no records listed in log"
true,0,0,q,("v"$.z.p)~"v"$trademeta[`start],1,,"Check correct start time listed for log"
true,0,0,q,("v"$.z.p)~"v"$quotemeta[`start],1,,"Check correct start time listed for log"
true,0,0,q,null trademeta[`end],1,,"Check no end time listed for log"
true,0,0,q,null quotemeta[`end],1,,"Check no end time listed for log"
run,0,0,q,.u.upd[`trade;testtrade],1,,"Run trade update"
run,0,0,q,.u.upd[`quote;testquote],1,,"Run quote update"
run,0,0,q,.u.upd[`quote;testquote],1,,"Run quote update"
run,0,0,q,.stplg.endofperiod[],1,,"Close logs"
run,0,0,q,"trademeta2:last select from .stpm.metatable where `trade in/: tbls,seq=0",1,,"Save updated trade table meta"
run,0,0,q,"quotemeta2:last select from .stpm.metatable where `quote in/: tbls,seq=0",1,,"Save updated quote table meta"
true,0,0,q,1=trademeta2[`msgcount],1,,"Check records meta updated"
true,0,0,q,2=quotemeta2[`msgcount],1,,"Check records meta updated"
true,0,0,q,not null trademeta2[`end],1,,"Check end time updated"
true,0,0,q,not null quotemeta2[`end],1,,"Check end time updated"
after,0,0,q,.z.ts[],1,,"Clear tables"
after,0,0,q,"system""rm -r "",1_string[.stplg.dldir]",1,,"Clear log directory"
