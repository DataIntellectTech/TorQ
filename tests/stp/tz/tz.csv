action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.servers.startup[],1,,"Start TorQ connection management"
before,0,0,q,handles:`def`mem`imm!gethandle each `stpdef`stpmem`stpimm,1,,"Get STP handles"
before,0,0,q,(value handles) @\: (eodinit;`Hongkong),1,,"Set STP TZs to Hong Kong time"
before,0,0,q,(value handles) @\: (system;"t 0"),1,,"Turn off STP timers"
before,0,0,q,(value handles) @\: "init .stplg.batchmode",1,,"Re-init STP"
before,0,0,q,(value handles) @\: (`.stplg.init;testlogdb),1,,"Create test stplog test directory"
before,0,0,q,logdir:1_string handles[`imm](`.stplg.dldir),1,,"Get location of log directory for immediate mode STP"
before,0,0,q,adj:(value handles) @\: ".eodtime.dailyadj",1,,"Get STP TZ adjustments"
run,0,0,q,(value handles) @\: (`.u.upd;`trade;testtrade),1,,"Publish trade update"
run,0,0,q,now:.z.p,1,,"Get current time"
run,0,0,q,-11!handles[`imm]"currlog[`trade;`logname]",1,,"Replay logs from immediate mode STP"
run,0,0,q,"stptime:(handles[`def`mem],0i) @\: ""first exec distinct time from trade""",1,,"Get STP time from all trade tables (incl. local)"
true,0,0,q,all 0D00:00:01>now-stptime-adj,1,,"Check that the timezone has been correctly applied"
after,0,0,q,.os.deldir logdir,1,,"Delete test segmented tickerplant logs"