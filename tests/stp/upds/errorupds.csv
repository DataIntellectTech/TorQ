action,ms,bytes,lang,code,repeat,minver,comment
beforeany,0,0,q,system "sleep 5",1,,"Wait for all procs to go up"
before,0,0,q,.servers.startup[],1,,"Get connection management set up"
before,0,0,q,system "sleep 2",1,,"Wait for all connections"
before,0,0,q,stpHandle:gethandle[`stp1],1,,"Get STP handle"
before,0,0,q,stpHandle(`.stplg.init;testlogdb),1,,"Switch test stplog directory"
before,0,0,q,startproc["rdb1"],1,,"start rdb"
before,0,0,q,system "sleep 2",1,,"Wait for all connections"
before,0,0,q,rdbHandle:gethandle[`rdb1],1,,"Get RDB handle"
before,0,0,q,stpHandle".stplg.errmode:1b",1,,"Ensure error mode is on in stp"
run,0,0,q,"stpHandle""init[`defaultbatch]"" ",1,,"Define timer and update functions"
run,0,0,q,stpHandle(`.u.upd;`undefinedtable;testtrade),1,,"Run update to an undefined table"
run,0,0,q,stplogdata: get stpHandle"currlog[`segmentederrorlogfile][`logname]",1,,"access latest error log file"
true,0,0,q,"1 ~ count stplogdata",1,,"one row in error log
run,0,0,q,"stpHandle""init[`memorybatch]"" ",1,,"Define timer and update functions"
run,0,0,q,"stpHandle(`.u.upd;`trade;testtrade,(enlist 10#`b),(enlist 10#`a))",1,,"Run trade update with data that is too wide"
run,0,0,q,stplogdata: get stpHandle"currlog[`segmentederrorlogfile][`logname]",1,,"access latest error log file"
true,0,0,q,"2 ~ count stplogdata",1,,"two rows in error log
run,0,0,q,"stpHandle""init[`immediate]"" ",1,,"Define timer and update functions"
run,0,0,q,stpHandle(`.u.upd;`undefinedtable;testtrade),1,,"Run update to an undefined table"
run,0,0,q,stplogdata: get stpHandle"currlog[`segmentederrorlogfile][`logname]",1,,"access latest error log file"
true,0,0,q,"3 ~ count stplogdata",1,,"three rows in error log"
true,0,0,q,"all (count each stplogdata[;2]) <> rdbHandle""count cols trade"" ",1,,"length of data is different to schema, time and seqnum are not being added"
true,0,0,q,all stplogdata[;1] in `trade`undefinedtable,1,,"Check only errors for trade and undefinedtable tables"
true,0,0,q,all `upderr = stplogdata[;0],1,,"check all entries are errors"
