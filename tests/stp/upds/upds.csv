action,ms,bytes,lang,code,repeat,minver,comment
beforeany,0,0,q,system "sleep 5",1,,"Wait for all procs to go up"
before,0,0,q,.servers.startup[],1,,"Get connection management set up"
before,0,0,q,system "sleep 2",1,,"Wait for all connections"
before,0,0,q,stpHandle:gethandle[`stp1],1,,"Get STP handle"
before,0,0,q,stpHandle(`.stplg.init;testlogdb),1,,"Switch test stplog directory"
before,0,0,q,startproc["rdb1"],1,,"Start segmented tickerplant in tabperiod mode"
before,0,0,q,system "sleep 2",1,,"Wait for all connections"
before,0,0,q,rdbHandle:gethandle[`rdb1],1,,"Get RDB handle"
before,0,0,q,"stpHandle"".stplg.updtab[`quote]: {(enlist(count first x)#y),(enlist(count first x)#(`long$ .stplg.seqnum)),x}"" ",1,,"set unique upd definition for quote table"
before,0,0,q,"stpHandle""system""""t 0"""" "" ",1,,"Turn off automatic publish"
run,0,0,q,"stpHandle""init[`defaultbatch]"" ",1,,"Define timer and update functions in defaultbatch mode"
run,0,0,q,stpHandle(`.u.upd;`quote;testquote),1,,"Run quote update"
run,0,0,q,stpHandle".z.ts[]",1,,"Publish updates"
true,0,0,q,rdbHandle"`seqnum in cols quote",1,,"Check sequence number is in schema of quote"
true,0,0,q,rdbHandle"not `seqnum in cols trade",1,,"Check sequence number is NOT in schema of trade"
true,0,0,q,rdbHandle"7h ~ type quote`seqnum",1,,"Check sequence numbers are of type long"
true,0,0,q,rdbHandle"not any null quote`seqnum",1,,"Check column is being filled with valid sequence numbers"
true,0,0,q,rdbHandle"not any 0 > deltas quote`seqnum",1,,"Check seq numbers are always ascending"
true,0,0,q,rdbHandle"10 ~ count quote",1,,"Check count of quote table"
run,0,0,q,rdbHandle"delete from `quote",1,,"Clear data"
run,0,0,q,"stpHandle""init[`memorybatch]"" ",1,,"Define timer and update functions in memorybatch mode"
run,0,0,q,stpHandle(`.u.upd;`quote;testquote),1,,"Run quote update"
run,0,0,q,stpHandle".z.ts[]",1,,"Publish updates"
true,0,0,q,rdbHandle"`seqnum in cols quote",1,,"Check sequence number is in schema of quote"
true,0,0,q,rdbHandle"not `seqnum in cols trade",1,,"Check sequence number is NOT in schema of trade"
true,0,0,q,rdbHandle"7h ~ type quote`seqnum",1,,"Check sequence numbers are of type long"
true,0,0,q,rdbHandle"not any null quote`seqnum",1,,"Check column is being filled with valid sequence numbers"
true,0,0,q,rdbHandle"not any 0 > deltas quote`seqnum",1,,"Check seq numbers are always ascending"
true,0,0,q,rdbHandle"10 ~ count quote",1,,"Check count of quote table"
run,0,0,q,rdbHandle"delete from `quote",1,,"Clear data"
run,0,0,q,"stpHandle""init[`immediate]"" ",1,,"Define timer and update functions in immediate mode"
run,0,0,q,stpHandle(`.u.upd;`quote;testquote),1,,"Run quote update"
run,0,0,q,stpHandle".z.ts[]",1,,"Publish updates"
true,0,0,q,rdbHandle"`seqnum in cols quote",1,,"Check sequence number is in schema of quote"
true,0,0,q,rdbHandle"not `seqnum in cols trade",1,,"Check sequence number is NOT in schema of trade"
true,0,0,q,rdbHandle"7h ~ type quote`seqnum",1,,"Check sequence numbers are of type long"
true,0,0,q,rdbHandle"not any null quote`seqnum",1,,"Check column is being filled with valid sequence numbers"
true,0,0,q,rdbHandle"not any 0 > deltas quote`seqnum",1,,"Check seq numbers are always ascending"
true,0,0,q,rdbHandle"10 ~ count quote",1,,"Check count of quote table"
after,0,0,q,rdbHandle"delete from `quote",1,,"Clear quote table
after,0,0,q,".os.deldir getenv[`KDBTPLOG],""/"", testlogdb,""_"",string .z.d",1,,"Delete test segmented tickerplant logs"