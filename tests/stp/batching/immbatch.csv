action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,stpHandle(system;"t 0"),1,,"Turn off STP timer"
before,0,0,q,stpHandle(`setup;`immediate),1,,"Set STP to immediate mode"
before,0,0,q,delete from `trade,1,,"Clear trade table"
before,0,0,q,r1:rdbHandle"count trade",1,,"Get inital RDB table count"
before,0,0,q,-11!stpHandle"currlog[`trade;`logname]",1,,"Replay initial logs"
before,0,0,q,t1:count trade,1,,"Get inital local table count"
before,0,0,q,delete from `trade,1,,"Clear trade table"
run,0,0,q,stpHandle(`.u.upd;`trade;batch1),1,,"Set STP to immediate mode"
run,0,0,q,system "sleep 1",1,,"Wait for publishing"
run,0,0,q,-11!stpHandle"currlog[`trade;`logname]",1,,"Replay logs"
true,0,0,q,(r1+10)~rdbHandle"count trade",1,,"Check RDB has received update"
true,0,0,q,(t1+10)~count trade,1,,"Check log has received update"
after,0,0,q,delete from `trade,1,,"Clear trade table"