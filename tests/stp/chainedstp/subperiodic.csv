action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,sctpHandle".stplg.multilog:`periodic",1,,"Change logging type"
before,0,0,q,sctpHandle"init[`defaultbatch]",1,,"Init SCTP main script"
before,0,0,q,sctpHandle".sctp.loggingmode:`create",1,,"Configure the SCTP to create logs"
before,0,0,q,sctpHandle(`.stplg.init;testsctpdb),1,,"Create test stplog test directory"
before,0,0,q,currlog:sctpHandle"currlog",1,,"Get SCTP log table"
before,0,0,q,met:sctpHandle".stpm.metatable",1,,"Get SCTP meta table"
run,0,0,q,"stpHandle @/: `.u.upd ,/: ((`trade;testtrade);(`quote;testquote);(`heartbeat;`error))",1,,"Publish table updates"
run,0,0,q,"sctpHandle @/: `.u.upd ,/: ((`trade;`error);(`quote;`error);(`heartbeat;`error))",1,,"Publish table updates"
run,0,0,q,system "sleep 1",1,,"Wait for update to publish"
run,0,0,q,![-11;] each exec logname from currlog where tbl in `trade`quote`segmentederrorlogfile,1,,"Replay logs locally"
true,0,0,q,"all not raze value exec null logname,null handle from currlog",1,,"Check lognames and handles generated"
true,0,0,q,all currlog[`trade;`logname]=exec logname from currlog where tbl<>`segmentederrorlogfile,1,,"Check lognames are the same"
true,0,0,q,currlog[`trade;`logname]~exec first logname from met,1,,"Check lognames the same in log and meta"
true,0,0,q,(0#trade)~(first exec schema from met)[`trade],1,,"Check trade schema saved to meta table"
true,0,0,q,(0#quote)~(first exec schema from met)[`quote],1,,"Check quote schema saved to meta table"
true,0,0,q,`error~.tst.err,1,,"Check errors were logged to disk"
after,0,0,q,"system ""rm -rf "",1_string stpHandle(`.stplg.dldir)",1,,"Delete logs folder"
after,0,0,q,"system ""rm -rf "",1_string sctpHandle(`.stplg.dldir)",1,,"Delete logs folder"