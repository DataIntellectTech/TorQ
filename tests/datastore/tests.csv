action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.servers.startup[],1,,"Start TorQ connection management"
before,0,0,q,.proc.sys "sleep 5",1,,"Wait 5 seconds"
before,0,0,q,".rdb.ignorelist,:`KUT`KUTR",1,,"Add test result tables to ignore list"
before,0,0,q,stph:gethandle[`stp1],1,,"Open STP handle"
before,0,0,q,rdbh:gethandle[`rdb1],1,,"Open RDB handle"
before,0,0,q,t1:rdbh @ "trade",1,,"Get initial trade table"
before,0,0,q,q1:rdbh @ "quote",1,,"Get initial quote table"
true,0,0,q,1b=.rdb.tailsortcomplete,1,,"Check tailsortcomplete flag initialises as true"
true,0,0,q,.ds.periodstokeep=.rdb.extendperiods,1,,"Check extendperiods is initialised as .ds.periodstokeep"
true,0,0,q,all 0<count each (t1;q1),1,,"Check that tables are populated before running eod"
run,0,0,q,endofday[.z.d;()!()],1,,"Run rdb endofday function"
true,0,0,q,all 0=count each (t1;q1),1,,"Check that tables have been wiped at eod"
true,0,0,q,0b=.rdb.tailsortcomplete,1,,"Check tailsortcomplete flag switches to false when eod function executed"
run,0,0,q,endofperiod[.z.p;.z.p+0D00:02;()!()],1,,"Run rdb endofperiodfunction"
true,0,0,q,.rdb.extendperiods>.ds.periodstokeep,1,,"Check extendperiods has been increased"
