action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.servers.startup[],1,,"Start TorQ connection management"
before,0,0,q,.os.sleep 2,1,,"Wait for proc to start"
before,0,0,q,".rdb.ignorelist,:`KUT`KUTR",1,,"Add test result tables to ignore list"
before,0,0,q,.sub.subscribe[`quote`trade;`;0b;0b] each .sub.getsubscriptionhandles[`segmentedtickerplant;`stp1;()!()],1,,"Subscribe to tickerplant"
true,0,0,q,1b=.ds.datastripe,1,,"Make sure datastriping is on"
true,0,0,q,1b=.rdb.tailsortcomplete,1,,"Check tailsortcomplete flag initialises as true"
true,0,0,q,.ds.periodstokeep=.rdb.extendperiods,1,,"Check extendperiods is initialised as .ds.periodstokeep"
true,0,0,q,all 0<count each (quote;trade),1,,"Check that tables are populated before running eod"
run,0,0,q,endofday[.z.d;()!()],1,,"Run rdb endofday function"
true,0,0,q,all 0=count each (quote;trade),1,,"Check that tables have been wiped at eod"
true,0,0,q,0b=.rdb.tailsortcomplete,1,,"Check tailsortcomplete flag switches to false when eod function executed"
run,0,0,q,endofperiod[.z.p;.z.p+0D00:02;()!()],1,,"Run rdb endofperiodfunction"
true,0,0,q,.rdb.extendperiods>.ds.periodstokeep,1,,"Check extendperiods has been increased"
