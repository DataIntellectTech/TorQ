action,ms,bytes,lang,code,repeat,minver,comment
before,0,0,q,.servers.startup[],1,,"Start TorQ connection management"
before,0,0,q,.proc.sys "sleep 3",1,,"Wait for proc to start"
before,0,0,q,w:gethandle[`wdbcol],1,,"Open wdb handle"
before,0,0,q,w(set;`.wdb.mergemode;`col),1,,"set mergemode to the standard"
before,0,0,q,h:gethandle[`hdb1],1,,"Open hdb handle"
before,0,0,q,w".sort.getsortcsv[.wdb.sortcsv]",1,,"Get test sort.csv file"
run,0,0,q,w(`.u.end;.z.d),1,,"trigger end of day function to save and merge data with today's date as the partition"
true,0,0,q,`p~(h"meta select from xdaily")[`sym]`a,1,,"Check p attribute is on sym column of xdaily in hdb"
true,0,0,q,(count xdaily) ~count h"select from xdaily",1,,"Check all rows of data have been merged to hdb"
true,0,0,q,0~w"count xdaily",1,,"Check xdaily has been deleted from in memory table"
after,0,0,q,.os.deldir string .wdb.savedir,1,,"remove temporary storage directory"
after,0,0,q,.os.deldir string .Q.dd[.wdb.hdbdir;`$string[.z.d]],1,,"remove test hdb partition"
